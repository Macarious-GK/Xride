<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Car Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer>
        (function() {
            const socket = new WebSocket('ws://' + window.location.host + '/ws/car-status/');
    
            let carElement = null; // Variable to hold the car card element
    
            socket.onopen = function() {
                console.log('WebSocket connection established');
            };
    
            socket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                console.log( data.car_data)
                const car = data;  // Directly assign the incoming data to car since it's not an array
    
                const monitorDiv = document.getElementById('car-monitor');
    
                // If carElement is not created yet, create it and insert it into the monitor div
                if (!carElement) {
                    carElement = document.createElement('div');
                    carElement.classList.add('card', 'shadow-sm', 'mb-3');
                    monitorDiv.appendChild(carElement);
                }
                console.log( data.car_data)
                // Update the car card content with the new data
                carElement.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title">ðŸš— Car ID: <strong>${car.car_data.car_id}</strong></h5>
                        <p class="card-text"><strong>Module:</strong> ${car.car_data.module}</p>
                        <p class="card-text"><strong>Location:</strong> Latitude: ${car.car_data.Latitude}, Longitude: ${car.car_data.Longitude}</p>
                        <p class="card-text"><strong>Speed:</strong> ${car.car_data.speed} km/h</p>
                        <p class="card-text"><strong>Fuel Level:</strong> ${car.car_data.fuel}%</p>
                        <p class="card-text" style="color: ${car.car_data.Engine === 'ON' ? 'green' : 'red'};">
                            <strong>Engine:</strong> ${car.car_data.Engine}
                        </p>
                        <p class="card-text"><strong>Doors:</strong> ${car.car_data.Doors}</p>
                        <p class="text-muted">Last Updated: ${car.car_data.Last_Updated}</p>
                    </div>
                    
                `;
            };
    
            socket.onerror = function(e) {
                console.log('WebSocket error:', e);
            };
    
            socket.onclose = function() {
                console.log('WebSocket connection closed');
            };
        })();
    </script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center">ðŸ“¡ Real-Time Car Monitoring</h2>
        <p class="text-center text-muted">Live updates from the fleet.</p>

        <div id="car-monitor" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
